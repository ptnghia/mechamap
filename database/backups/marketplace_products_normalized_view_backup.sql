-- Backup of marketplace_products_normalized view definition
-- Created: 2025-08-24 18:26:35
-- Reason: Removing unused view as part of cleanup

CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `marketplace_products_normalized` AS select `marketplace_products`.`id` AS `id`,`marketplace_products`.`uuid` AS `uuid`,`marketplace_products`.`name` AS `name`,`marketplace_products`.`slug` AS `slug`,`marketplace_products`.`description` AS `description`,`marketplace_products`.`short_description` AS `short_description`,`marketplace_products`.`sku` AS `sku`,`marketplace_products`.`seller_id` AS `seller_id`,`marketplace_products`.`product_category_id` AS `product_category_id`,`marketplace_products`.`product_type` AS `product_type`,`marketplace_products`.`seller_type` AS `seller_type`,`marketplace_products`.`industry_category` AS `industry_category`,`marketplace_products`.`price` AS `regular_price`,case when `marketplace_products`.`is_on_sale` = 1 and `marketplace_products`.`sale_price` is not null and `marketplace_products`.`sale_price` < `marketplace_products`.`price` then `marketplace_products`.`sale_price` else `marketplace_products`.`price` end AS `effective_price`,case when `marketplace_products`.`is_on_sale` = 1 and `marketplace_products`.`sale_price` is not null and `marketplace_products`.`sale_price` < `marketplace_products`.`price` then round((`marketplace_products`.`price` - `marketplace_products`.`sale_price`) / `marketplace_products`.`price` * 100,2) else 0 end AS `discount_percentage`,case when `marketplace_products`.`product_type` = 'digital' then 1 when `marketplace_products`.`manage_stock` = 0 then 1 when `marketplace_products`.`stock_quantity` > 0 then 1 else 0 end AS `is_available`,case when `marketplace_products`.`product_type` = 'digital' then 1 when json_length(coalesce(`marketplace_products`.`digital_files`,'[]')) > 0 then 1 else 0 end AS `is_digital_product`,coalesce(`marketplace_products`.`file_size_mb`,0) AS `file_size_mb`,`marketplace_products`.`status` AS `status`,`marketplace_products`.`is_featured` AS `is_featured`,`marketplace_products`.`is_active` AS `is_active`,`marketplace_products`.`approved_at` AS `approved_at`,`marketplace_products`.`view_count` AS `view_count`,`marketplace_products`.`purchase_count` AS `purchase_count`,`marketplace_products`.`download_count` AS `download_count`,`marketplace_products`.`rating_average` AS `rating_average`,`marketplace_products`.`rating_count` AS `rating_count`,`marketplace_products`.`created_at` AS `created_at`,`marketplace_products`.`updated_at` AS `updated_at` from `marketplace_products` where `marketplace_products`.`deleted_at` is null;
